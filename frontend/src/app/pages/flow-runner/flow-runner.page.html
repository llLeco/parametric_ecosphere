<ion-header>
  <ion-toolbar>
    <ion-title>Parametric Flow Runner</ion-title>
    <ion-buttons slot="end">
      <ion-button routerLink="/settings">Settings</ion-button>
    </ion-buttons>
  </ion-toolbar>
  <ion-toolbar>
    <wallet-connection></wallet-connection>
  </ion-toolbar>
  <ion-toolbar>
    <ion-title size="small">Base URL: {{ ctx.snapshot.baseUrl }}</ion-title>
    <ion-buttons slot="end">
      <ion-button color="primary" [disabled]="runningStep==='ALL'" (click)="runAll()">
        <ion-spinner *ngIf="runningStep==='ALL'" name="dots"></ion-spinner>
        <span *ngIf="runningStep!=='ALL'">Run All</span>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
  <ion-toolbar>
    <ion-title size="small">Timeline</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <ion-list>
    <ion-item *ngFor="let item of ctx.snapshot.timeline">
      <ion-label>
        <h3>{{ item.ts }} â€” {{ item.type }}</h3>
        <p>{{ item.label }}</p>
      </ion-label>
    </ion-item>
  </ion-list>

  <app-step-card
    [title]="'Create Rule'"
    [method]="'POST'"
    [path]="'/rules'"
    [role]="'admin'"
    [payloadTemplate]="createRuleTemplate"
    [running]="runningStep==='Create Rule'"
    [result]="results['Create Rule']"
    (execute)="onCreateRule($event)"
  ></app-step-card>

  <app-step-card
    [title]="'Create Policy'"
    [method]="'POST'"
    [path]="'/policy-factory'"
    [role]="'admin'"
    [payloadTemplate]="createPolicyTemplate"
    [running]="runningStep==='Create Policy'"
    [result]="results['Create Policy']"
    (execute)="onCreatePolicy($event)"
  ></app-step-card>

  <app-step-card
    [title]="'Premium to Pool'"
    [method]="'POST'"
    [path]="'/pool-events/pool/premium'"
    [role]="'admin'"
    [payloadTemplate]="premiumToPoolTemplate"
    [running]="runningStep==='Premium to Pool'"
    [result]="results['Premium to Pool']"
    (execute)="onPremiumToPool($event)"
  ></app-step-card>

  <app-step-card
    [title]="'Trigger Event'"
    [method]="'POST'"
    [path]="'/triggers'"
    [role]="'oracle'"
    [payloadTemplate]="triggerTemplate"
    [running]="runningStep==='Trigger Event'"
    [result]="results['Trigger Event']"
    (execute)="onTriggerEvent($event)"
  ></app-step-card>

  <app-step-card
    [title]="'Execute Payout'"
    [method]="'POST'"
    [path]="'/payouts/' + (ctx.snapshot.policy?.policyId || 'pol_001') + '/execute'"
    [role]="'admin'"
    [payloadTemplate]="payoutTemplate"
    [running]="runningStep==='Execute Payout'"
    [result]="results['Execute Payout']"
    (execute)="onExecutePayout($event)"
  ></app-step-card>

</ion-content>


